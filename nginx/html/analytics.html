<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Pineapple Index â€” Analytics</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-X5E2L44KYG"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'G-X5E2L44KYG');
  </script>
  <script src="/js/ga-events.js" defer></script>
  <script src="/js/shared.js" defer></script>
  <script src="/js/analytics.js" defer></script>
</head>
<body>
  <nav class="main-nav">
    <a href="/" class="nav-link"><span class="nav-icon">ğŸ</span><span class="nav-text">Browse</span></a>
    <a href="/list" class="nav-link"><span class="nav-icon">ğŸ”</span><span class="nav-text">Advanced</span></a>
    <a href="/discover" class="nav-link"><span class="nav-icon">âœ¨</span><span class="nav-text">Discover</span></a>
    <a href="/analytics" class="nav-link active"><span class="nav-icon">ğŸ“ˆ</span><span class="nav-text">Analytics</span></a>
  </nav>
  
  <!-- Floating refresh button -->
  <button id="refreshBtn" class="floating-refresh-btn" title="Refresh data">
    <span class="refresh-icon">â†»</span>
  </button>
  
  <div class="browse-container">
    <div class="page" style="padding-top: 32px; padding-bottom: 60px;">
    <header style="margin-bottom: 32px;">
      <h1 style="margin-bottom: 12px;">Analytics Control Room</h1>
      <p class="lead">A wide-angle view of all Reddit mentions we track. Explore volume over time, identify standout subreddits and posts, and keep tabs on scanner health.</p>
      <div class="meta">
        <span class="pill" id="lastScanned">Last DB run: â€”</span>
        <span class="pill" id="lastPolled">Last polled: â€”</span>
        <span class="pill" id="window">Window: 30 days</span>
      </div>
      <div class="controls">
        <span class="muted" style="margin-right: 8px;">Timeline window:</span>
        <button class="btn" data-days="30">30d</button>
        <button class="btn" data-days="90">90d</button>
        <button class="btn" data-days="180">180d</button>
        <button class="btn" data-days="365">1y</button>
        <button class="btn" data-days="999999">All time</button>
      </div>
    </header>

    <section class="grid" id="statGrid">
      <div class="card">
        <h3 id="totalMentionsTitle">Total mentions recorded</h3>
        <div class="stat-value" id="totalMentions">â€”</div>
        <div class="stat-sub" id="mentionsPerDay">â€”</div>
      </div>
      <div class="card">
        <h3 id="totalSubsTitle">Total subreddits</h3>
        <div class="stat-value" id="totalSubs">â€”</div>
        <div class="stat-sub">All unique tracked subs.</div>
      </div>
      <div class="card">
        <h3 id="totalPostsTitle">Total posts tracked</h3>
        <div class="stat-value" id="totalPosts">â€”</div>
        <div class="stat-sub" id="mentionsPerPost">â€”</div>
      </div>
      <div class="card">
        <h3 id="totalCommentsTitle">Total comments scanned</h3>
        <div class="stat-value" id="totalComments">â€”</div>
        <div class="stat-sub" id="commentsPerPost">â€”</div>
      </div>
      <div class="card">
        <h3>Latest scan</h3>
        <div class="stat-value" id="lastScanNewMentions">â€”</div>
        <div class="stat-sub" id="lastScanMeta">â€”</div>
      </div>
      <div class="card">
        <h3 id="peakMentionTitle">Peak mention day</h3>
        <div class="stat-value" id="peakDay">â€”</div>
        <div class="stat-sub" id="peakValue">â€”</div>
      </div>
      <div class="card">
        <h3 id="newSubsTitle">New subs</h3>
        <div class="stat-value" id="newSubs30">â€”</div>
        <div class="stat-sub" id="newSubsDesc">First-time mentions.</div>
      </div>
      <div class="card card-wide">
        <h3 id="topCommenterTitle">Top commenter</h3>
        <div class="stat-value" id="topCommenterName">â€”</div>
        <div class="stat-sub" id="topCommenterCount">â€”</div>
      </div>
    </section>

    <section class="layout">
      <div class="card">
        <div class="row-title">
          <h3 style="margin:0">Volume over time</h3>
          <small id="timelineSummary">â€”</small>
        </div>
        <div class="chart-wrap"><canvas id="timelineChart"></canvas></div>
      </div>
      <div class="card">
        <div class="row-title">
          <h3 style="margin:0">New subreddits per day</h3>
          <small id="subsSummary">â€”</small>
        </div>
        <div class="chart-wrap" style="height: 320px"><canvas id="subsChart"></canvas></div>
        <p class="muted" style="margin:10px 0 0">Shows first-time appearances of a subreddit in comments.</p>
      </div>
    </section>

    <section class="split">
      <div class="card">
        <div class="row-title"><h3 style="margin:0">Top subreddits</h3><small>By total mentions</small></div>
        <table class="table" id="topSubredditsTable">
          <thead><tr><th>#</th><th>Subreddit</th><th>Mentions</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="card">
        <div class="row-title"><h3 style="margin:0">Top commenters</h3><small>By mentions recorded</small></div>
        <table class="table" id="topCommentersTable">
          <thead><tr><th>#</th><th>User</th><th>Comments</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <section class="split" style="margin-top: 20px;">
      <div class="card">
        <div class="row-title"><h3 style="margin:0">Top posts</h3><small>Most-mentioned posts</small></div>
        <table class="table" id="topPostsTable">
          <thead><tr><th>#</th><th>Post</th><th>Mentions</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="card">
        <div class="row-title"><h3 style="margin:0">Unique reach</h3><small>Posts with widest subreddit spread</small></div>
        <table class="table" id="topUniquePostsTable">
          <thead><tr><th>#</th><th>Post</th><th>Distinct subs</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <section style="margin-top: 40px; margin-bottom: 20px;">
      <h2 style="margin-bottom: 16px;">Metadata Health</h2>
      <p class="muted" style="margin-bottom: 24px;">Statistics about subreddit metadata freshness and completeness.</p>
    </section>

    <section class="grid" id="metadataGrid">
      <div class="card">
        <h3>Total Subreddits</h3>
        <div class="stat-value" id="metaTotalSubs">â€”</div>
        <div class="stat-sub">All tracked subreddits</div>
      </div>
      <div class="card">
        <h3>Up-to-date</h3>
        <div class="stat-value" id="metaUpToDate">â€”</div>
        <div class="stat-sub" id="metaUpToDatePct">Recently checked</div>
      </div>
      <div class="card">
        <h3>Stale metadata</h3>
        <div class="stat-value" id="metaStale">â€”</div>
        <div class="stat-sub" id="metaStalePct">Needs refresh</div>
      </div>
      <div class="card">
        <h3>Never checked</h3>
        <div class="stat-value" id="metaNeverChecked">â€”</div>
        <div class="stat-sub" id="metaNeverCheckedPct">No metadata fetched yet</div>
      </div>
      <div class="card">
        <h3>Without metadata</h3>
        <div class="stat-value" id="metaWithout">â€”</div>
        <div class="stat-sub" id="metaWithoutPct">Missing title, subs &amp; desc</div>
      </div>
      <div class="card">
        <h3>Banned</h3>
        <div class="stat-value" id="metaBanned">â€”</div>
        <div class="stat-sub" id="metaBannedPct">Banned subreddits</div>
      </div>
      <div class="card">
        <h3>Not found</h3>
        <div class="stat-value" id="metaNotFound">â€”</div>
        <div class="stat-sub" id="metaNotFoundPct">Don't exist (404)</div>
      </div>
      <div class="card">
        <h3>Pending retry</h3>
        <div class="stat-value" id="metaPendingRetry">â€”</div>
        <div class="stat-sub" id="metaPendingRetryPct">Waiting after error</div>
      </div>
      <div class="card">
        <h3>NSFW</h3>
        <div class="stat-value" id="metaNsfw">â€”</div>
        <div class="stat-sub" id="metaNsfwPct">18+ subreddits</div>
      </div>
      <div class="card">
        <h3>With subscribers</h3>
        <div class="stat-value" id="metaWithSubs">â€”</div>
        <div class="stat-sub" id="metaWithSubsPct">Have subscriber counts</div>
      </div>
      <div class="card">
        <h3>With descriptions</h3>
        <div class="stat-value" id="metaWithDesc">â€”</div>
        <div class="stat-sub" id="metaWithDescPct">Have description text</div>
      </div>
    </section>
  </div>

</body>
</html>
